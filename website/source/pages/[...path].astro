---
import { DEFAULT_LANGUAGE } from '@catechism/source/types/types';

import BaseLayout from '@layouts/base-layout.astro';
import CatechismContentWrapper from '@components/catechism-content/catechism-content-wrapper.astro';
import ApostolicConstitution from '@components/apostolic-constitution/apostolic-constitution.astro';
import ApostolicLetter from '@components/apostolic-letter/apostolic-letter.astro';
import Glossary from '@components/glossary.astro';
import IndexCitations from '@components/index-citations.astro';
import IndexTopics from '@components/index-topics.astro';

import { getAllParagraphNumbersSync, getParagraphPathIdMapSync, getSemanticPathPathIdMapSync } from '@logic/artifacts';
import { getLanguageTag, getParagraphNumber, removeLanguageTag } from '@logic/routing';
import { Slot } from '@logic/ui';
import { BasicPath, ContentRoute, getBasicRoutes, getParagraphNumberRoutes, getTableOfContentsRoutes } from '@pages/_routes';

export function getStaticPaths(): Array<ContentRoute> {
    // prettier-ignore
    return [
        ...getBasicRoutes(),
        ...getParagraphNumberRoutes(),
        ...getTableOfContentsRoutes()
    ];
}

const language = getLanguageTag(Astro.params.path) ?? DEFAULT_LANGUAGE;
const path = removeLanguageTag(Astro.params.path, language);

const isApostolicConstitution = BasicPath.APOSTOLIC_CONSTITUTION === path;
const isApostolicLetter = BasicPath.APOSTOLIC_LETTER === path;
const isGlossary = BasicPath.GLOSSARY === path;
const isIndexCitations = BasicPath.INDEX_CITATIONS === path;
const isIndexTopics = BasicPath.INDEX_TOPICS === path;

let pathID = null;

if (!isApostolicConstitution && !isApostolicLetter) {
    pathID = getSemanticPathPathIdMapSync(language)[path] ?? null;

    if (!pathID) {
        const paragraphNumber = getParagraphNumber(path);
        if (paragraphNumber) {
            const paragraphNumbers = getAllParagraphNumbersSync(language);
            if (paragraphNumbers.includes(paragraphNumber)) {
                pathID = getParagraphPathIdMapSync(language)[paragraphNumber] ?? null;
            }
        }
    }
}

const isCatechismContent = !!pathID;
---

<BaseLayout language={language}>
    <Fragment slot={Slot.CONTENT}>
        {isApostolicConstitution && <ApostolicConstitution language={language} />}
        {isApostolicLetter && <ApostolicLetter language={language} />}
        {isGlossary && <Glossary language={language} />}
        {isIndexCitations && <IndexCitations language={language} />}
        {isIndexTopics && <IndexTopics language={language} />}

        {isCatechismContent && <CatechismContentWrapper pathID={pathID} language={language} />}
    </Fragment>
</BaseLayout>
