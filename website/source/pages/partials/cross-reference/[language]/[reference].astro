---
import { NumberOrNumberRange } from '@catechism-types';

import CrossReferenceContent from '@components/content/catechism/cross-reference-content.astro';
import Replacement from '@components/replacement.astro';

import { getParagraphCrossReferenceContentMap, getParagraphNumberUrlMap } from '@logic/artifacts';
import { ElementID } from '@logic/ui';
import { CrossReferenceRoute, getCrossReferencePartialRoutes } from '@pages/_routes';

export const partial = true;

export function getStaticPaths(): Promise<Array<CrossReferenceRoute>> {
    return getCrossReferencePartialRoutes();
}

const language = Astro.params.language;
// Replace hyphens with en dashes
const reference = Astro.params.reference
    // Decode UTF-8-encoded en dashes
    .replace('%E2%80%93', '–')
    // Replace a hyphen with an en dash
    .replace('-', '–') as NumberOrNumberRange;

const contentMap = await getParagraphCrossReferenceContentMap(language);
const paragraphs = contentMap[reference];

const paragraphUrlMap = await getParagraphNumberUrlMap(language);
const firstParagraphNumber = paragraphs[0].paragraphNumber;
const url = paragraphUrlMap[firstParagraphNumber];
---

<Replacement target={ElementID.CROSS_REFERENCE_DRAWER_CONTENT_WRAPPER}>
    <CrossReferenceContent {reference} {paragraphs} {url} {language} />
</Replacement>
