---
import { DEFAULT_LANGUAGE } from '@catechism-types';

import GeneralContent from '@components/general-content.astro';
import ContentLayout from '@layouts/content-layout.astro';

import { getSemanticPathPathIdMap } from '@logic/artifacts';
import { getLanguageTag, getPathIdFromParagraphNumberPath, isAuxiliaryRoute, removeLanguageTag } from '@logic/routing';
import { ContentRoute, getAuxiliaryRoutes, getParagraphNumberRoutes, getTableOfContentsRoutes } from '@pages/_routes';

export async function getStaticPaths(): Promise<Array<ContentRoute>> {
    return [
        ...getAuxiliaryRoutes(),
        ...(await getParagraphNumberRoutes()),
        ...(await getTableOfContentsRoutes()),
    ];
}

const language = getLanguageTag(Astro.params.path) ?? DEFAULT_LANGUAGE;
const path = removeLanguageTag(Astro.params.path, language);
let pathID = null;

const isPotentialContentPath = path && !isAuxiliaryRoute(path, language);
if (isPotentialContentPath) {
    const semanticPathMap = await getSemanticPathPathIdMap(language);
    pathID = semanticPathMap[path] ?? await getPathIdFromParagraphNumberPath(path, language);
}
---

<ContentLayout {language}>
    <GeneralContent {path} {pathID} {language} />
</ContentLayout>
