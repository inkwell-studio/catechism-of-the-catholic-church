---
import { Article as ArticleType, Language } from '@catechism-types';
import { getFinalContent, getInBrief, getMainContent, getOpeningContent } from '@catechism-utils/content';
import { getRomanNumeral } from '@catechism-utils/title';

import { getUrlFragment } from '@logic/routing';
import { translate as t } from '@logic/translation';

import ContentBaseArray from './content-base-array.astro';
import ReadingAreaIntersectable from './reading-area-intersectable.astro';

interface Props {
    article: ArticleType;
    language: Language;
    firstContentOnPageLoad: boolean;
}

const { article, language, firstContentOnPageLoad } = Astro.props;

const nonFinalChildContent = [...getOpeningContent(article), ...getMainContent(article)];

const inBrief = getInBrief(article);
if (inBrief) {
    nonFinalChildContent.push(inBrief);
}

const finalContent = getFinalContent(article);
---

<ReadingAreaIntersectable content={article} {language} class:list={[{ 'mt-8': !firstContentOnPageLoad }]}>
    <div
        id={getUrlFragment(article.semanticPath, false, language).fragment}
        class="bg-neutral-150 py-8 px-4 mb-8 border-b border-b-stone-200 sm:rounded-sm dark:bg-zinc-750 dark:border-none"
    >
        <div class="font-sans font-bold text-base text-stone-600 text-center tracking-wider uppercase px-text mb-2 dark:text-stone-300">
            {t('Article', language)} {getRomanNumeral(article.articleNumber)}
        </div>
        <h4 class="font-title font-medium text-3xl text-center text-stone-700 tracking-wide px-text dark:text-stone-200">
            {article.title}
        </h4>
    </div>

    <ContentBaseArray content={nonFinalChildContent} {language} ) />

    {
        finalContent.length > 0 && (
            <div id={t('final-content', language)}>
                <ContentBaseArray content={finalContent} {language} />
            </div>
        )
    }
</ReadingAreaIntersectable>
